<!doctype html>
<html>
<meta charset="utf-8" />
<div id="twitch_player"></div>
<script src="https://player.twitch.tv/js/embed/v1.js"></script>
<script src="https://fastly.jsdelivr.net/npm/jquery@3.7.1/dist/jquery.min.js"></script>
<script type="text/javascript">

    var tc_vid = "";
    var tc_channel = "";
    var quality;
    
    const urlObj = new URL(window.location.href);

    tc_channel = urlObj.searchParams.get("ch");
    tc_vid = urlObj.searchParams.get("id");
    quality = urlObj.searchParams.get("q");
    
    var options = {
        width: 1920,
        height: 1080,
        channel: tc_channel,
        video: tc_vid
        //parent: "www.cloudflare.com"
    };
    var player = new Twitch.Player("twitch_player", options);

    player.addEventListener(Twitch.Player.ENDED, () => {
        console.log(`视频已停止`);
        window.obsstudio.stopStreaming();
    });

    player.addEventListener(Twitch.Player.PLAY, () => {
        console.log(`视频已开始`);
        let qStr = player.getQualities();
        console.log(qStr);
    });

    player.addEventListener(Twitch.Player.PLAYING, () => {
        console.log(`视频已播放`);
        if(quality) {
            player.setQuality(quality);
            console.log(`已设置画质 ${quality}`);
        }
        if(!quality) console.log(`未指定画质`);
        console.log(qStr);
    });
</script>
</html>
